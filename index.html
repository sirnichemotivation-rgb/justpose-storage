<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Justpose Gallery</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* FIX: Siguraduhin na ang download button ay laging nasa top-right ng screen */
        .fixed-download {
            position: fixed; top: 20px; right: 20px; 
            background: rgba(255,255,255,0.8); color: #000;
            width: 45px; height: 45px; border-radius: 50%;
            display: flex; justify-content: center; align-items: center; 
            text-decoration: none; font-weight: bold; font-size: 22px; z-index: 5000;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
        }
        video { max-width: 95%; max-height: 85%; border-radius: 10px; }
    </style>
</head>
<body>
    <header><h1 id="mainTitle">JUSTPOSE GALLERY</h1></header>
    
    <div id="gallery"></div>

    <div id="photoModal">
        <div class="close-x" onclick="closeModal()">×</div>
        <a id="mainDownloadBtn" href="#" class="fixed-download" download>↓</a>
        <div id="modalContent"></div>
    </div>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const eventId = urlParams.get('event');
        const gallery = document.getElementById('gallery');
        const modal = document.getElementById('photoModal');
        const modalContent = document.getElementById('modalContent');
        const dlBtn = document.getElementById('mainDownloadBtn');

        if (eventId) {
            const fbURL = `https://justposegallery-default-rtdb.asia-southeast1.firebasedatabase.app/events/${eventId}.json`;

            function loadPhotos() {
                fetch(fbURL).then(res => res.json()).then(data => {
                    if (data) {
                        gallery.innerHTML = "";
                        const photoArray = Object.values(data).reverse();
                        
                        photoArray.forEach(item => {
                            const card = document.createElement('div');
                            card.className = "img-card";
                            card.onclick = () => openFolder(item.url);
                            
                            // Check kung MP4 o Image
                            if (item.url.toLowerCase().endsWith('.mp4')) {
                                card.innerHTML = `<video muted loop autoplay src="${item.url}" style="width:100%; height:180px; object-fit:cover;"></video>`;
                            } else {
                                card.innerHTML = `<img src="${item.url}">`;
                            }
                            gallery.appendChild(card);
                        });
                    }
                });
            }

            function openFolder(url) {
                modal.style.display = "flex";
                modalContent.innerHTML = "";
                dlBtn.href = url; // I-set ang download link sa current file

                const div = document.createElement('div');
                div.className = "folder-item"; // Gagamit ng scroll-snap-align: center mula sa CSS mo
                
                if (url.toLowerCase().endsWith('.mp4')) {
                    div.innerHTML = `<video controls autoplay loop src="${url}"></video>`;
                } else {
                    div.innerHTML = `<img src="${url}">`;
                }
                
                modalContent.appendChild(div);
            }

            function closeModal() { modal.style.display = "none"; }

            loadPhotos();
            setInterval(loadPhotos, 5000);
        }
    </script>
</body>
</html>
