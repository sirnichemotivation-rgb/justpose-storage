<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Justpose Gallery</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header><h1>JUSTPOSE GALLERY</h1></header>
    <div id="gallery"></div>

    <div id="photoModal">
        <div class="close-x" onclick="closeModal()">×</div>
        <a id="fixedDL" href="#" class="mini-download-btn" download>↓</a>
        <div id="modalContent"></div>
    </div>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const eventId = urlParams.get('event');
        const gallery = document.getElementById('gallery');
        const modal = document.getElementById('photoModal');
        const modalContent = document.getElementById('modalContent');
        const fixedDL = document.getElementById('fixedDL');

        if (eventId) {
            const fbURL = `https://justposegallery-default-rtdb.asia-southeast1.firebasedatabase.app/events/${eventId}.json`;

            function loadPhotos() {
                fetch(fbURL).then(res => res.json()).then(data => {
                    if (data) {
                        gallery.innerHTML = "";
                        const photoArray = Object.values(data).reverse();
                        
                        photoArray.forEach(item => {
                            const card = document.createElement('div');
                            card.className = "img-card";
                            card.onclick = () => openModal(item.url);
                            
                            // Check kung Video o Image ang thumbnail
                            if (item.url.toLowerCase().endsWith('.mp4')) {
                                card.innerHTML = `<video src="${item.url}" muted loop autoplay></video>`;
                            } else {
                                card.innerHTML = `<img src="${item.url}">`;
                            }
                            gallery.appendChild(card);
                        });
                    }
                });
            }

            function openModal(url) {
                modal.style.display = "flex";
                modalContent.innerHTML = "";
                fixedDL.href = url; // I-set ang download link

                const div = document.createElement('div');
                div.className = "folder-item";
                
                if (url.toLowerCase().endsWith('.mp4')) {
                    div.innerHTML = `<video src="${url}" controls autoplay loop></video>`;
                } else {
                    div.innerHTML = `<img src="${url}">`;
                }
                
                modalContent.appendChild(div);
            }

            function closeModal() { modal.style.display = "none"; }

            loadPhotos();
            setInterval(loadPhotos, 5000); // Auto-refresh every 5s
        }
    </script>
</body>
</html>
